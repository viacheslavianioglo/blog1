<?php//// Менеджер статей//class M_Articles{	private static $instance; 	// ссылка на экземпляр класса	private $msql; 				// драйвер БД		//	// Получение единственного экземпляра (одиночка)	//	public static function Instance()	{		if (self::$instance == null)			self::$instance = new M_Articles();				return self::$instance;	}	//	// Конструктор	//	public function __construct()	{		$this->msql = M_MSQL::Instance();	}		//	// Список всех статей	//	public function All()	{		$query = "SELECT * 				  FROM articles 				  ORDER BY id_article DESC";				  		return $this->msql->Select($query);	}	public function All_articles_from_user($id_user)	{		$t = "SELECT *				  FROM articles as a				  JOIN users as u ON u.id_user = a.id_user				  WHERE u.id_user = '%d'				  ORDER BY id_article DESC;";        $query  = sprintf($t, $id_user);		return $this->msql->Select($query);	}    public function belongs_article_to_user($id_user, $id_article)    {        $t = "SELECT COUNT(*) as cnt				  FROM articles as a				  JOIN users as u ON u.id_user = a.id_user				  WHERE u.id_user = '%d'				  AND a.id_article = '%d'				  ORDER BY id_article DESC;";        $query  = sprintf($t, $id_user,  mysql_real_escape_string($id_article));        $res =  $this->msql->Select($query);        return ((int)$res[0]['cnt'] > 0);    }    public function Get_user_from_article($id_article)    {        $t = "SELECT *				  FROM articles as a				  JOIN users as u ON u.id_user = a.id_user				  WHERE a.id_article = '%d'";        $query  = sprintf($t, mysql_real_escape_string($id_article));        $result =  $this->msql->Select($query);        return $result[0];    }    public function All_intro($articles)    {//        $arr = $this->All();        $arr = $articles;        foreach($arr as $key=>$value)            $arr[$key]['intro'] = $this->Intro($value);        return $arr;    }	//	// Конкретная статья	//	public function Get($id_article)	{		// Запрос.		$t = "SELECT * 			  FROM articles 			  WHERE id_article = '%d'";			  		$query = sprintf($t, $id_article);		$result = $this->msql->Select($query);		return $result[0];	}	//	// Добавить статью	//	public function Add($title, $content, $id_user)	{		// Подготовка.		$title = trim($title);		$content = trim($content);		// Проверка.		if ($title == '')			return false;				// Запрос.		$obj = array();		$obj['title'] = $title;		$obj['content'] = $content;        $obj['id_user'] = $id_user;				$this->msql->Insert('articles', $obj);		return true;	}	//	// Изменить статью	//	public function Edit($id_article, $title, $content)	{		// Подготовка.		$title = trim($title);		$content = trim($content);		// Проверка.		if ($title == '')			return false;				// Запрос.		$obj = array();		$obj['title'] = $title;		$obj['content'] = $content;				$t = "id_article = '%d'";				$where = sprintf($t, $id_article);				$this->msql->Update('articles', $obj, $where);		return true;	}	//	// Удалить статью	//	public function Delete($id_article)	{		// Запрос.		$t = "id_article = '%d'";				$where = sprintf($t, $id_article);				$this->msql->Delete('articles', $where);		return true;	}	function Intro($article)	{		// $article - это ассоциативный массив, представляющий статью		return substr($article['content'], 0, 10) . "...";	}}